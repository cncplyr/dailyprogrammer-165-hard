<!DOCTYPE html>
<html>
<head>
	<title>Daily Programmer #165 [Hard]: Simulated Ecology - The Forest</title>
	
	<!-- Ours -->
	<script src="js/map.js"></script>
	<script src="js/agents.js"></script>
	<script src="js/simulation.js"></script>
	
	<!-- 3rd Party -->
	<script src="//ajax.googleapis.com/ajax/libs/jquery/2.1.0/jquery.min.js"></script>
</head>
<body>
	<canvas id="canvas" width="600" height="600"></canvas>
	<button type="button" onclick="reset();">Reset</button>
	<button type="button" onclick="tickMonth();">Tick</button>
	<button type="button" onclick="toggleRun();">Run/Stop</button>
	
	<script type="text/javascript">
		var canvas = document.getElementById('canvas');
		var cellSize = 10;
		var simulationSize = 59
		var s = new Simulation(simulationSize);
		var running = false;
		
		draw();
		setInterval('run()', 50);
		
		function reset() {
			s = new Simulation(simulationSize);
			draw();
		}
		
		function toggleRun(){
			if (!running) {
				running = true;
			} else {
				running = false;
			}
		}
		
		function run() {
			if (running) {
				tickMonth();
			}
		}
	
		function tickMonth() {
			s.tickMonth();
			draw();
		}
	
		function draw() {
			canvas.width = canvas.width;
			var ctx = canvas.getContext('2d');x
			
			var size = cellSize;
			var map = s.map
			
			ctx.save();
			ctx.translate(size, size);
			
			for(var x = 0; x < map.mapSize; x++){
				for(var y = 0; y < map.mapSize; y++){
					var agents = map.get(x, y);
				
					if (agents instanceof Array && agents.length > 0) {
						// Set the colour for that animal
						switch(agents[agents.length - 1].type){ // TODO 
							case 'sapling':
								// saplings are light green 
								ctx.fillStyle = 'rgb(152, 251, 152)';
								break;
							case 'mature':
								// mature are medium green
								ctx.fillStyle = 'rgb(119, 221, 119)';
								break;
							case 'elder':
								// elder are dark green
								ctx.fillStyle = 'rgb(34, 139, 34)';
								break;
							case 'lumberjack':
								// lumberjacks wear red
								ctx.fillStyle = 'rgb(190, 0, 50)';
								break;
							case 'bear':
								// bears are brown
								ctx.fillStyle = 'rgb(150, 75, 0)';
								break;
						}
						// Draw a circle where the animal is
						ctx.moveTo(x*size+(size/2),y*size);
						ctx.beginPath();
						ctx.arc(x*size, y*size, size/2, 0, 2*Math.PI);
						ctx.closePath();
						ctx.fill();
					}
				}
			}
			
			ctx.restore();
		}
	</script>
</body>
</html>