<!DOCTYPE html>
<html lang="en">
<head>
	<title>Daily Programmer #165 [Hard]: Simulated Ecology - The Forest</title>
	
	<!-- JQuery -->
	<script src="//ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
	<!-- Bootstrap -->
	<link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap.min.css">
	<script src="//maxcdn.bootstrapcdn.com/bootstrap/3.3.2/js/bootstrap.min.js"></script>
	<!-- d3 -->
	<script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.3/d3.min.js"></script>
	<!-- c3 -->
	<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/c3/0.4.9/c3.min.css">
	<script src="https://cdnjs.cloudflare.com/ajax/libs/c3/0.4.9/c3.min.js"></script>
	
	<!-- Ours -->
	<script src="js/map.js"></script>
	<script src="js/agents.js"></script>
	<script src="js/simulation.js"></script>
</head>
<body>
	<div class="container-fluid">
		<div class="row">
			<div id="canvas-container" class="col-xs-9">
				<canvas id="canvas" width="600" height="600"></canvas>
			</div>
			<div class="col-xs-3">
				<h3>Statistics</h3>
				<div id="chart"></div>
			</div>
		</div>
		<div class="row">
			<div class="col-xs-2">
				<button type="button" class="btn btn-primary btn-block" onclick="toggleRun();">Start/Stop</button>
				<button type="button" class="btn btn-default btn-block" onclick="reset();">Reset</button>
			</div>
			<div class="col-xs-2">
				<button type="button" class="btn btn-default btn-block" onclick="tickMonth();">Tick</button>
			</div>
			<div class="col-xs-8">
				
			</div>
		</div>
	</div>
	
	<script type="text/javascript">
		var canvas = document.getElementById('canvas');
		var cellSize = 10;
		var simulationSize = 59
		var s = new Simulation(simulationSize);
		var running = false;
		
		function reset() {
			s = new Simulation(simulationSize);
			draw();
		}
		
		function toggleRun(){
			running = running ? false : true;
		}
		
		function run() {
			if (running) {
				tickMonth();
			}
		}
	
		function tickMonth() {
			s.tickMonth();
			updateChart();
			draw();
		}
	
		function draw() {
			canvas.width = canvas.width;
			var ctx = canvas.getContext('2d');
			
			var size = cellSize;
			var map = s.map
			
			ctx.save();
			ctx.translate(size, size);
			
			for(var x = 0; x < map.mapSize; x++){
				for(var y = 0; y < map.mapSize; y++){
					var agents = map.get(x, y);
				
					if (agents instanceof Array && agents.length > 0) {
						// Set the colour for that animal
						switch(agents[agents.length - 1].type){ // TODO 
							case 'sapling':
								// saplings are light green 
								ctx.fillStyle = 'rgb(152, 251, 152)';
								break;
							case 'mature':
								// mature are medium green
								ctx.fillStyle = 'rgb(119, 221, 119)';
								break;
							case 'elder':
								// elder are dark green
								ctx.fillStyle = 'rgb(34, 139, 34)';
								break;
							case 'lumberjack':
								// lumberjacks wear red
								ctx.fillStyle = 'rgb(190, 0, 50)';
								break;
							case 'bear':
								// bears are brown
								ctx.fillStyle = 'rgb(150, 75, 0)';
								break;
						}
						// Draw a circle where the animal is
						ctx.moveTo(x * size + (size / 2), y * size);
						ctx.beginPath();
						ctx.arc(x * size, y * size, size / 2, 0, 2 * Math.PI);
						ctx.closePath();
						ctx.fill();
					}
				}
			}
			
			ctx.restore();
		}
		
		$(document).ready(function() {
			draw();
			setInterval('run()', 50);
		});
	</script>
	
	<script type="text/javascript">
		var chart = c3.generate({
			bindto: '#chart',
			data: {
				columns: [
					['lumberjacks', 0],
					['bears', 0],
					['trees', 0]
				]
			}
		});
		
		function updateChart() {
			chart.load({
				columns: [
					['lumberjacks', Math.floor(Math.random() * 200), Math.floor(Math.random() * 200), Math.floor(Math.random() * 200)]
				]
			});
		}
	</script>
	
	<!-- Google Analytics -->
	<script>
		(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
		(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
		m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
		})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

		ga('create', 'UA-58040822-1', 'auto');
		ga('send', 'pageview');
	</script>
</body>
</html>
